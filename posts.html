<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Winter BANG ê´€ë ¨ ì •ë³´ê¸€ ë° ë§í¬ ëª¨ìŒ">
    <title>ì •ë³´ê¸€ | Winter BANG</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="src/title.svg" alt="Winter BANG" class="logo-svg">
            </a>
            <ul class="nav-menu">
                <li><a href="index.html">ë©”ì¸</a></li>
                <li><a href="transport.html">êµí†µí¸</a></li>
                <li><a href="venue.html">ë‚´ë¶€ì •ë³´</a></li>
                <li><a href="posts.html" class="active">ì •ë³´ê¸€</a></li>
            </ul>
            <div class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
        <!-- í˜ì´ì§€ í—¤ë” -->
        <header class="page-header">
            <h1>ğŸ“° ì •ë³´ê¸€</h1>
            <p>ê³µì—° ê´€ë ¨ ë‰´ìŠ¤ ë° ìœ ìš©í•œ ì •ë³´ë“¤ì„ í™•ì¸í•˜ì„¸ìš”</p>
        </header>

        <section class="section">
            <h2 class="section-title">ìµœì‹  ì†Œì‹</h2>
            <div id="posts-grid" class="posts-grid">
                <!-- CSVì—ì„œ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                <div class="loading-message">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </section>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">
                <img src="src/title.svg" alt="Winter BANG" class="logo-svg">
            </div>
            <div class="footer-links">
                <a href="index.html">ë©”ì¸</a>
                <a href="transport.html">êµí†µí¸</a>
                <a href="venue.html">ë‚´ë¶€ì •ë³´</a>
                <a href="posts.html">ì •ë³´ê¸€</a>
            </div>
            <p class="copyright">Â© 2026 Winter BANG. All rights reserved.</p>
        </div>
    </footer>

    <script>
        function toggleMenu() {
            document.querySelector('.nav-menu').classList.toggle('active');
        }

        // CSV íŒŒì‹± í•¨ìˆ˜
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            const posts = [];

            for (let i = 1; i < lines.length; i++) {
                const values = [];
                let current = '';
                let inQuotes = false;

                for (let char of lines[i]) {
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current.trim());

                if (values.length >= 5) {
                    posts.push({
                        title: values[0],
                        url: values[1],
                        preview: values[2],
                        image: values[3],
                        date: values[4]
                    });
                }
            }
            return posts;
        }

        // ë‚ ì§œ í¬ë§· í•¨ìˆ˜
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            if (isNaN(date)) return dateStr;
            return `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
        }

        // ê²Œì‹œê¸€ ì¹´ë“œ ìƒì„± í•¨ìˆ˜
        function createPostCard(post) {
            const imagePath = `src/image/posts/${post.image}`;
            return `
                <a href="${post.url}" target="_blank" rel="noopener noreferrer" class="post-card">
                    <img src="${imagePath}" alt="${post.title}" class="post-card-image" 
                         onerror="this.outerHTML='<div class=\\'post-card-image placeholder-img\\'>ğŸ“°</div>'">
                    <div class="post-card-content">
                        <h3>${post.title}</h3>
                        <p>${post.preview}</p>
                        <div class="post-card-meta">
                            <span>${formatDate(post.date)}</span>
                            <span class="post-card-link">ìì„¸íˆ ë³´ê¸° â†’</span>
                        </div>
                    </div>
                </a>
            `;
        }

        // CSV ë¡œë“œ ë° ë Œë”ë§
        async function loadPosts() {
            const postsGrid = document.getElementById('posts-grid');
            
            try {
                const response = await fetch('src/data/posts.csv');
                if (!response.ok) throw new Error('CSV íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                
                // ANSI(EUC-KR) ì¸ì½”ë”©ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì½ê¸°
                const buffer = await response.arrayBuffer();
                const decoder = new TextDecoder('euc-kr');
                const csvText = decoder.decode(buffer);
                const posts = parseCSV(csvText);

                if (posts.length === 0) {
                    postsGrid.innerHTML = '<div class="no-posts">ë“±ë¡ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
                posts.sort((a, b) => new Date(b.date) - new Date(a.date));

                postsGrid.innerHTML = posts.map(post => createPostCard(post)).join('');
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
                postsGrid.innerHTML = `
                    <div class="error-message">
                        ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                        <small>src/data/posts.csv íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</small>
                    </div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', loadPosts);
    </script>
</body>
</html>
