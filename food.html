<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Winter BANG ê³µì—°ì¥ ì£¼ë³€ ë§›ì§‘ ì•ˆë‚´ - ëŒ€ì „ ìŒì•…ì°½ì‘ì†Œ">
    <title>ë§›ì§‘ | Winter BANG</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=eiykz9i91u"></script>
    <script src="https://cdn.jsdelivr.net/gh/nicgirault/circularProgress@1.0.0/dist/circularProgress.min.js"></script>
    <script>
        // MarkerClustering ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¸ë¼ì¸ ì •ì˜
        var MarkerClustering = function(options) {
            this._map = options.map || null;
            this._markers = options.markers || [];
            this._minClusterSize = options.minClusterSize || 2;
            this._maxZoom = options.maxZoom || 13;
            this._gridSize = options.gridSize || 100;
            this._icons = options.icons || [];
            this._indexGenerator = options.indexGenerator || [];
            this._stylingFunction = options.stylingFunction || function() {};
            this._disableClickZoom = options.disableClickZoom || false;
            this._clusters = [];
            this._mapMarkers = [];
            this._listeners = [];
            
            if (this._map) {
                this._init();
            }
        };
        
        MarkerClustering.prototype = {
            _init: function() {
                this._createClusters();
                this._bindEvents();
            },
            
            _bindEvents: function() {
                var self = this;
                var zoomListener = naver.maps.Event.addListener(this._map, 'zoom_changed', function() {
                    if (self._map) self._redraw();
                });
                var dragListener = naver.maps.Event.addListener(this._map, 'dragend', function() {
                    if (self._map) self._redraw();
                });
                this._listeners.push(zoomListener, dragListener);
            },
            
            _removeEvents: function() {
                for (var i = 0; i < this._listeners.length; i++) {
                    naver.maps.Event.removeListener(this._listeners[i]);
                }
                this._listeners = [];
            },
            
            _redraw: function() {
                if (!this._map) return;
                this._clearClusters();
                this._createClusters();
            },
            
            _clearClusters: function() {
                for (var i = 0; i < this._mapMarkers.length; i++) {
                    this._mapMarkers[i].setMap(null);
                }
                this._mapMarkers = [];
                this._clusters = [];
            },
            
            _createClusters: function() {
                if (!this._map) return;
                
                var zoom = this._map.getZoom();
                
                if (zoom > this._maxZoom) {
                    // ì¤Œì´ ì¶©ë¶„íˆ í¬ë©´ ê°œë³„ ë§ˆì»¤ í‘œì‹œ
                    for (var i = 0; i < this._markers.length; i++) {
                        this._markers[i].setMap(this._map);
                        this._mapMarkers.push(this._markers[i]);
                    }
                    return;
                }
                
                // ë§ˆì»¤ ìˆ¨ê¸°ê¸°
                for (var i = 0; i < this._markers.length; i++) {
                    this._markers[i].setMap(null);
                }
                
                var bounds = this._map.getBounds();
                var projection = this._map.getProjection();
                var clusters = [];
                
                for (var i = 0; i < this._markers.length; i++) {
                    var marker = this._markers[i];
                    var position = marker.getPosition();
                    
                    // bounds ì²´í¬ë¥¼ ê±´ë„ˆë›°ê³  ëª¨ë“  ë§ˆì»¤ ì²˜ë¦¬
                    var pixelPos = projection.fromCoordToOffset(position);
                    var clusterFound = false;
                    
                    for (var j = 0; j < clusters.length; j++) {
                        var cluster = clusters[j];
                        var clusterPixelPos = projection.fromCoordToOffset(cluster.center);
                        var dx = pixelPos.x - clusterPixelPos.x;
                        var dy = pixelPos.y - clusterPixelPos.y;
                        var distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < this._gridSize) {
                            cluster.markers.push(marker);
                            clusterFound = true;
                            break;
                        }
                    }
                    
                    if (!clusterFound) {
                        clusters.push({
                            center: position,
                            markers: [marker]
                        });
                    }
                }
                
                this._clusters = clusters;
                this._displayClusters();
            },
            
            _displayClusters: function() {
                var self = this;
                if (!this._map) return;
                
                for (var i = 0; i < this._clusters.length; i++) {
                    var cluster = this._clusters[i];
                    
                    if (cluster.markers.length < this._minClusterSize) {
                        // í´ëŸ¬ìŠ¤í„° í¬ê¸°ê°€ ì‘ìœ¼ë©´ ê°œë³„ ë§ˆì»¤ í‘œì‹œ
                        for (var j = 0; j < cluster.markers.length; j++) {
                            cluster.markers[j].setMap(this._map);
                            this._mapMarkers.push(cluster.markers[j]);
                        }
                    } else {
                        // í´ëŸ¬ìŠ¤í„° ë§ˆì»¤ ìƒì„±
                        var count = cluster.markers.length;
                        var iconIndex = this._getIconIndex(count);
                        var icon = this._icons[iconIndex] || this._icons[0];
                        
                        var clusterMarker = new naver.maps.Marker({
                            position: cluster.center,
                            map: this._map,
                            icon: icon
                        });
                        
                        clusterMarker._cluster = cluster;
                        this._stylingFunction(clusterMarker, count);
                        
                        if (!this._disableClickZoom) {
                            (function(cm, cl, mapRef) {
                                naver.maps.Event.addListener(cm, 'click', function() {
                                    if (!mapRef._map) return;
                                    var bounds = new naver.maps.LatLngBounds();
                                    for (var k = 0; k < cl.markers.length; k++) {
                                        bounds.extend(cl.markers[k].getPosition());
                                    }
                                    mapRef._map.fitBounds(bounds);
                                });
                            })(clusterMarker, cluster, self);
                        }
                        
                        this._mapMarkers.push(clusterMarker);
                    }
                }
            },
            
            _getIconIndex: function(count) {
                for (var i = 0; i < this._indexGenerator.length; i++) {
                    if (count < this._indexGenerator[i]) {
                        return i;
                    }
                }
                return this._icons.length - 1;
            },
            
            setMap: function(map) {
                if (map === null) {
                    this._removeEvents();
                    this._clearClusters();
                    this._map = null;
                } else {
                    this._map = map;
                    this._init();
                }
            },
            
            getMap: function() {
                return this._map;
            }
        };
    </script>
    <style>
        /* ì§€ë„ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .food-map-container {
            width: 100%;
            height: 500px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
        }

        #food-map {
            width: 100%;
            height: 100%;
        }

        /* ì •ë³´ì°½ ìŠ¤íƒ€ì¼ */
        .iw-container {
            padding: 15px;
            background: #1a1a2e;
            border-radius: 10px;
            min-width: 200px;
            max-width: 300px;
        }

        .iw-container h4 {
            margin: 0 0 8px 0;
            color: #e94560;
            font-size: 16px;
            font-weight: 700;
        }

        .iw-container p {
            margin: 0 0 8px 0;
            color: #eaeaea;
            font-size: 13px;
            line-height: 1.5;
        }

        .iw-container .category {
            display: inline-block;
            padding: 3px 8px;
            background: #e94560;
            color: white;
            border-radius: 12px;
            font-size: 11px;
            margin-top: 5px;
        }

        .iw-footer {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .detail-btn {
            display: inline-block;
            padding: 4px 10px;
            background: #4CAF50;
            color: white !important;
            border-radius: 12px;
            font-size: 11px;
            text-decoration: none;
            transition: background 0.3s ease;
        }

        .detail-btn:hover {
            background: #45a049;
            color: white !important;
        }

        /* ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .food-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .food-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .food-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.2);
            border-color: var(--accent-color);
        }

        .food-card h4 {
            color: var(--accent-color);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }

        .food-card p {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .food-card .category-tag {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(233, 69, 96, 0.2);
            color: var(--accent-color);
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 0.5rem;
        }

        .food-card .distance {
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }

        .food-card .food-desc {
            color: var(--text-color);
            font-size: 0.9rem;
            margin: 0.5rem 0;
            line-height: 1.5;
        }

        .card-footer {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .detail-link {
            color: #4CAF50 !important;
            font-size: 0.85rem;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .detail-link:hover {
            color: #45a049 !important;
            text-decoration: underline;
        }

        /* ë²”ë¡€ */
        .map-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .legend-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-venue {
            background: #4CAF50;
        }

        .legend-food {
            background: #e94560;
        }

        /* íƒœê·¸ í•„í„° ë²„íŠ¼ */
        .tag-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--card-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .tag-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: transparent;
            color: var(--text-color);
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .tag-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .tag-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        /* í´ëŸ¬ìŠ¤í„° ìŠ¤íƒ€ì¼ */
        .cluster-marker {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e94560;
            color: white;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="src/title.svg" alt="Winter BANG" class="logo-svg">
            </a>
            <ul class="nav-menu">
                <li><a href="index.html">ë©”ì¸</a></li>
                <li><a href="transport.html">êµí†µí¸</a></li>
                <li><a href="venue.html">ë‚´ë¶€ì •ë³´</a></li>
                <li><a href="food.html" class="active">ë§›ì§‘</a></li>
                <li><a href="posts.html">ì •ë³´ê¸€</a></li>
            </ul>
            <div class="hamburger" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="main-content">
        <!-- í˜ì´ì§€ í—¤ë” -->
        <header class="page-header">
            <h1>ğŸ½ï¸ ì£¼ë³€ ë§›ì§‘</h1>
            <p>ê³µì—°ì¥ ê·¼ì²˜ì—ì„œ ë§›ìˆëŠ” ì‹ì‚¬ë¥¼ ì¦ê²¨ë³´ì„¸ìš”</p>
        </header>

        <section class="section">
            <h2 class="section-title">ë§›ì§‘ ì§€ë„</h2>
            
            <!-- íƒœê·¸ í•„í„° -->
            <div class="tag-filter" id="tag-filter">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì  ìƒì„± -->
            </div>

            <!-- ë²”ë¡€ -->
            <div class="map-legend">
                <div class="legend-item">
                    <div class="legend-marker legend-venue"></div>
                    <span>ëŒ€ì „ ìŒì•…ì°½ì‘ì†Œ (ê³µì—°ì¥)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-marker legend-food"></div>
                    <span>ì¶”ì²œ ë§›ì§‘</span>
                </div>
            </div>

            <!-- ë„¤ì´ë²„ ì§€ë„ -->
            <div class="food-map-container">
                <div id="food-map"></div>
            </div>

            <h2 class="section-title">ë§›ì§‘ ë¦¬ìŠ¤íŠ¸</h2>
            <div class="food-list" id="food-list">
                <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë™ì  ìƒì„± -->
            </div>
        </section>
    </main>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo">
                <img src="src/title.svg" alt="Winter BANG" class="logo-svg">
            </div>
            <div class="footer-links">
                <a href="index.html">ë©”ì¸</a>
                <a href="transport.html">êµí†µí¸</a>
                <a href="venue.html">ë‚´ë¶€ì •ë³´</a>
                <a href="food.html">ë§›ì§‘</a>
                <a href="posts.html">ì •ë³´ê¸€</a>
            </div>
            <p class="copyright">Â© 2026 Winter BANG. All rights reserved.</p>
        </div>
    </footer>

    <script>
        function toggleMenu() {
            document.querySelector('.nav-menu').classList.toggle('active');
        }

        // ê³µì—°ì¥ ìœ„ì¹˜ (ëŒ€ì „ ìŒì•…ì°½ì‘ì†Œ)
        const venueLocation = new naver.maps.LatLng(36.3262212, 127.4304601);
        const venueLat = 36.3262212;
        const venueLng = 127.4304601;

        // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (Haversine formula)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371000; // ì§€êµ¬ ë°˜ê²½ (ë¯¸í„°)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // ê±°ë¦¬ë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
        function formatDistance(meters) {
            if (meters < 1000) {
                return `ì•½ ${Math.round(meters)}m`;
            } else {
                return `ì•½ ${(meters / 1000).toFixed(1)}km`;
            }
        }

        // ë§›ì§‘ ë°ì´í„° (JSON íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¨ ì •ë³´)
        // tag: ì¹´í…Œê³ ë¦¬ (ì§ì ‘ ë¶„ë¥˜), description: ê°€ê²Œ ì„¤ëª…, placeid: ë„¤ì´ë²„ ì§€ë„ ì¥ì†Œ ID
        const foodPlaces = [
            { name: "ê³ ë² ê·œì¹´ì¸  ëŒ€ì „ì€í–‰ì ", lat: 36.3276188, lng: 127.4270277, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ëŒ€ì¢…ë¡œ480ë²ˆê¸¸ 7", tag: "ì¼ì‹", description: "", placeid: "1780792210" },
            { name: "ê³µì£¼ ì–¼í°ì´ ì¹¼êµ­ìˆ˜ ì­ˆê¾¸ë¯¸", lat: 36.3279655, lng: 127.4268225, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘êµë¡œ73ë²ˆê¸¸ 33", tag: "í•œì‹", description: "", placeid: "20601293" },
            { name: "ê¸¸ë“œì»¤í”¼", lat: 36.3443306, lng: 127.3842132, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì„œêµ¬ ë¬¸ì •ë¡œ48ë²ˆê¸¸ 52", tag: "ì¹´í˜", description: "", placeid: "1572181945" },
            { name: "ëŒ€ì „ë²„ê±°", lat: 36.3357918, lng: 127.4368521, address: "ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ ë™ê´‘ì¥ë¡œ 86", tag: "í–„ë²„ê±°", description: "", placeid: "1361327777" },
            { name: "ë™ë¶ì•„", lat: 36.3348015, lng: 127.4378124, address: "ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ ì² ê°‘ê¸¸ 45", tag: "ì¤‘ì‹", description: "", placeid: "1557779077" },
            { name: "ë•¡íë² ë¦¬ë¨¸ì¹˜", lat: 36.3259399, lng: 127.4251216, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘êµë¡œ 49", tag: "ì¹´í˜", description: "", placeid: "1191786029" },
            { name: "ëª¨ì„  ìœ¼ëŠ¥ì •ì´ì ", lat: 36.3263688, lng: 127.4295706, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ëŒ€ì¢…ë¡œ460ë²ˆê¸¸ 38", tag: "ì¼ì‹", description: "", placeid: "2089270490" },
            { name: "ë³´ë¬¸ì‚°í˜¸ë­ì´", lat: 36.3269168, lng: 127.4287776, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘êµë¡œ 84-1", tag: "ì–‘ì‹", description: "", placeid: "1380141772" },
            { name: "ë¹„ë²”", lat: 36.3359679, lng: 127.4372593, address: "ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ ìˆ˜í–¥ê¸¸ 99", tag: "í•œì‹", description: "", placeid: "1617575885" },
            { name: "ë½€ë¹ ì´", lat: 36.3271299, lng: 127.4280880, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ156ë²ˆê¸¸ 45", tag: "ì–‘ì‹", description: "", placeid: "1572920229" },
            { name: "ì„±ì‹¬ë‹¹ ëŒ€ì „ì—­ì ", lat: 36.3323500, lng: 127.4342001, address: "ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ ì¤‘ì•™ë¡œ 215 ëŒ€ì „ì—­", tag: "ì„±ì‹¬ë‹¹", description: "", placeid: "36731468" },
            { name: "ì„±ì‹¬ë‹¹ ë¡¯ë°ë°±í™”ì ", lat: 36.3406490, lng: 127.3895366, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì„œêµ¬ ê³„ë£¡ë¡œ 598 ë¡¯ë°ë°±í™”ì ", tag: "ì„±ì‹¬ë‹¹", description: "", placeid: "1170663310" },
            { name: "ì„±ì‹¬ë‹¹ ë³¸ì ", lat: 36.3277442, lng: 127.4272458, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ëŒ€ì¢…ë¡œ480ë²ˆê¸¸ 15", tag: "ì„±ì‹¬ë‹¹", description: "", placeid: "11871325" },
            { name: "ì„±ì‹¬ë‹¹ ì‚ì•„ë˜", lat: 36.3278141, lng: 127.4274116, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ156ë²ˆê¸¸ 28", tag: "ì–‘ì‹", description: "", placeid: "16259064" },
            { name: "ì„±ì‹¬ë‹¹ DCCì ", lat: 36.3749837, lng: 127.3916916, address: "ëŒ€ì „ê´‘ì—­ì‹œ ìœ ì„±êµ¬ ì—‘ìŠ¤í¬ë¡œ 107 ëŒ€ì „ì»¨ë²¤ì…˜ì„¼í„°", tag: "ì„±ì‹¬ë‹¹", description: "", placeid: "1977855888" },
            { name: "ì„±ì‹¬ë‹¹ìš°ë™ì•¼", lat: 36.3277442, lng: 127.4272458, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ëŒ€ì¢…ë¡œ480ë²ˆê¸¸ 15", tag: "ì¼ì‹", description: "", placeid: "20601419" },
            { name: "ìˆ˜ì•ˆì´ˆë°¥ ëŒ€í¥ì ", lat: 36.3263258, lng: 127.4258388, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ138ë²ˆê¸¸ 48 ì¤‘ì•™ë¡œ ì„¼í…€ì‹œí‹°", tag: "ì¼ì‹", description: "", placeid: "1398705438" },
            { name: "ì•„ëœ¨ëœ¨ ëŒ€ì „ì€í–‰ì ", lat: 36.3272184, lng: 127.4287460, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ164ë²ˆê¸¸ 50", tag: "í•œì‹", description: "", placeid: "1081873211" },
            { name: "ì•„ì €ì”¨ëˆê¹ŒìŠ¤", lat: 36.3281608, lng: 127.4279558, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ164ë²ˆê¸¸ 22-7", tag: "ì¼ì‹", description: "", placeid: "16045092" },
            { name: "ì—ê·¸ê·¸ ë³¸ì ", lat: 36.3282120, lng: 127.4286737, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ëŒ€ì¢…ë¡œ480ë²ˆê¸¸ 39", tag: "ì–‘ì‹", description: "", placeid: "1726740061" },
            { name: "ì—°ìš°ë™ ì€í–‰ë™ë³¸ì ", lat: 36.3282016, lng: 127.4291842, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ëŒ€ì¢…ë¡œ480ë²ˆê¸¸ 50", tag: "ì¼ì‹", description: "", placeid: "1639391056" },
            { name: "ì˜›í„°êµ­ìˆ˜ì „ë¬¸ì  ì›”í‰ì ", lat: 36.3535488, lng: 127.3569149, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì„œêµ¬ ì›”í‰ìƒˆëœ¸ë¡œ4ë²ˆê¸¸ 69", tag: "í•œì‹", description: "", placeid: "16220617" },
            { name: "ì˜¤ì”¨ì¹¼êµ­ìˆ˜", lat: 36.3278257, lng: 127.4338757, address: "ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ ì¤‘ì•™ë¡œ204ë²ˆê¸¸ 75", tag: "í•œì‹", description: "", placeid: "15951083" },
            { name: "ì´ˆë¯¸ë‹¹ ì„¸ë²ˆì§¸", lat: 36.3347245, lng: 127.4501493, address: "ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ ë°±ë£¡ë¡œ 32-1", tag: "ì¼ì‹", description: "", placeid: "1341363538" },
            { name: "ì¹´ì¸ ê³ ë©”ì´", lat: 36.3443306, lng: 127.3842132, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì„œêµ¬ ë¬¸ì •ë¡œ48ë²ˆê¸¸ 52", tag: "ì¼ì‹", description: "", placeid: "1043015071" },
            { name: "ì¹´í˜ì‚¬ë‚˜ê³ ", lat: 36.3265936, lng: 127.4278975, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘êµë¡œ 76", tag: "ì¹´í˜", description: "", placeid: "1236904226" },
            { name: "íƒœí‰ì†Œêµ­ë°¥", lat: 36.3267596, lng: 127.3954917, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ íƒœí‰ë¡œ 116", tag: "í•œì‹", description: "", placeid: "601999582" },
            { name: "íŒŒë€ë“¤ì‹ë‹¹", lat: 36.3257101, lng: 127.4164341, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì„ í™”ì„œë¡œ23ë²ˆê¸¸ 50", tag: "í•œì‹", description: "", placeid: "19833251" },
            { name: "íŒ”ë¡¬ë¹„ë‹ˆ ì€í–‰ì ", lat: 36.3283598, lng: 127.4284484, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ164ë²ˆê¸¸ 21-6", tag: "ì¹´í˜", description: "", placeid: "1847921946" },
            { name: "í™•ì¥ì„±", lat: 36.3265439, lng: 127.4276957, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘êµë¡œ 74", tag: "ì¹´í˜", description: "", placeid: "1048983558" },
            { name: "í¬í¬ì´ˆë°¥", lat: 36.3284823, lng: 127.4292128, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ170ë²ˆê¸¸ 27", tag: "ì¼ì‹", description: "", placeid: "1223607842" },
            { name: "ë§˜ìŠ¤í„°ì¹˜ ëŒ€ì „ì€í–‰ì ", lat: 36.3270085, lng: 127.4281593, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ156ë²ˆê¸¸ 49", tag: "í–„ë²„ê±°", description: "", placeid: "1059006260" },
            { name: "ë¡¯ë°ë¦¬ì•„ ëŒ€ì „ì¤‘ì•™ì ", lat: 36.3286288, lng: 127.4250088, address: "ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ ì¤‘ì•™ë¡œ 139", tag: "í–„ë²„ê±°", description: "", placeid: "11824854" }
        ].map(place => ({
            ...place,
            distance: formatDistance(calculateDistance(venueLat, venueLng, place.lat, place.lng))
        })).sort((a, b) => {
            // ê±°ë¦¬ìˆœ ì •ë ¬
            const distA = calculateDistance(venueLat, venueLng, a.lat, a.lng);
            const distB = calculateDistance(venueLat, venueLng, b.lat, b.lng);
            return distA - distB;
        });

        // ì§€ë„ ì´ˆê¸°í™”
        const map = new naver.maps.Map('food-map', {
            center: venueLocation,
            zoom: 15,
            zoomControl: true,
            zoomControlOptions: {
                position: naver.maps.Position.TOP_RIGHT
            }
        });

        // ê³ ìœ  íƒœê·¸ ëª©ë¡ ì¶”ì¶œ
        const allTags = [...new Set(foodPlaces.map(p => p.tag).filter(t => t))];
        
        // íƒœê·¸ í•„í„° ë²„íŠ¼ ìƒì„±
        const tagFilterContainer = document.getElementById('tag-filter');
        let currentTag = 'ì „ì²´';
        
        // ì „ì²´ ë²„íŠ¼
        const allBtn = document.createElement('button');
        allBtn.className = 'tag-btn active';
        allBtn.textContent = 'ì „ì²´';
        allBtn.addEventListener('click', () => filterByTag('ì „ì²´'));
        tagFilterContainer.appendChild(allBtn);
        
        // ê° íƒœê·¸ ë²„íŠ¼
        allTags.forEach(tag => {
            const btn = document.createElement('button');
            btn.className = 'tag-btn';
            btn.textContent = tag;
            btn.addEventListener('click', () => filterByTag(tag));
            tagFilterContainer.appendChild(btn);
        });

        // ê³µì—°ì¥ ë§ˆì»¤ (ë…¹ìƒ‰) - zIndexë¥¼ ë†’ê²Œ ì„¤ì •í•˜ì—¬ ìµœìƒë‹¨ì— í‘œì‹œ
        const venueMarker = new naver.maps.Marker({
            position: venueLocation,
            map: map,
            zIndex: 1000,
            icon: {
                content: '<div style="background:#4CAF50;color:white;padding:8px 12px;border-radius:20px;font-weight:bold;font-size:12px;box-shadow:0 2px 10px rgba(0,0,0,0.3);white-space:nowrap;position:relative;z-index:1000;">ğŸµ ëŒ€ì „ ìŒì•…ì°½ì‘ì†Œ</div>',
                anchor: new naver.maps.Point(60, 20)
            }
        });

        // ê³µì—°ì¥ ì •ë³´ì°½
        const venueInfoWindow = new naver.maps.InfoWindow({
            content: `
                <div class="iw-container">
                    <h4>ğŸµ ëŒ€ì „ ìŒì•…ì°½ì‘ì†Œ</h4>
                    <p>Winter BANG ê³µì—°ì¥<br>2026.01.17 PM 5:00</p>
                    <span class="category">ê³µì—°ì¥</span>
                </div>
            `,
            borderWidth: 0,
            backgroundColor: 'transparent'
        });

        naver.maps.Event.addListener(venueMarker, 'click', function() {
            if (venueInfoWindow.getMap()) {
                venueInfoWindow.close();
            } else {
                venueInfoWindow.open(map, venueMarker);
            }
        });

        // ë§›ì§‘ ë§ˆì»¤ ë° ì •ë³´ì°½ ìƒì„±
        const markers = [];
        const infoWindows = [];
        let markerCluster = null;

        // ê°™ì€ ìœ„ì¹˜ì˜ ë§ˆì»¤ë“¤ì„ ê°ì§€í•˜ì—¬ ì˜¤í”„ì…‹ ê³„ì‚°
        const positionMap = {};
        foodPlaces.forEach((place, index) => {
            const key = `${place.lat.toFixed(6)}_${place.lng.toFixed(6)}`;
            if (!positionMap[key]) {
                positionMap[key] = [];
            }
            positionMap[key].push(index);
        });

        // ì˜¤í”„ì…‹ ê³„ì‚° í•¨ìˆ˜ (ê°™ì€ ìœ„ì¹˜ì— ì—¬ëŸ¬ ë§ˆì»¤ê°€ ìˆì„ ë•Œ)
        function getMarkerOffset(placeIndex) {
            for (const key in positionMap) {
                const indices = positionMap[key];
                if (indices.includes(placeIndex) && indices.length > 1) {
                    const posInGroup = indices.indexOf(placeIndex);
                    const total = indices.length;
                    // ìœ„ì•„ë˜ë¡œ ë¶„ì‚° (ì„¸ë¡œ ì˜¤í”„ì…‹)
                    const offsetY = (posInGroup - (total - 1) / 2) * 35;
                    return { x: 0, y: offsetY };
                }
            }
            return { x: 0, y: 0 };
        }

        foodPlaces.forEach((place, index) => {
            const position = new naver.maps.LatLng(place.lat, place.lng);
            const offset = getMarkerOffset(index);
            
            // ë§ˆì»¤ ìƒì„± (í´ëŸ¬ìŠ¤í„°ìš©ìœ¼ë¡œ mapì€ ë‚˜ì¤‘ì— ì„¤ì •)
            const marker = new naver.maps.Marker({
                position: position,
                icon: {
                    content: `<div style="background:#e94560;color:white;padding:6px 10px;border-radius:15px;font-weight:bold;font-size:11px;box-shadow:0 2px 10px rgba(0,0,0,0.3);white-space:nowrap;transform:translateY(${offset.y}px);">ğŸ½ï¸ ${place.name}</div>`,
                    anchor: new naver.maps.Point(50, 15 - offset.y)
                }
            });
            marker.tag = place.tag; // íƒœê·¸ ì •ë³´ ì €ì¥
            marker.placeIndex = index; // ì¸ë±ìŠ¤ ì €ì¥

            // ì •ë³´ì°½ ìƒì„±
            const descHtml = place.description ? `<p style="margin-top:8px;">${place.description}</p>` : '';
            const detailBtn = place.placeid ? `<a href="https://map.naver.com/p/entry/place/${place.placeid}" target="_blank" class="detail-btn">ìƒì„¸ì •ë³´</a>` : '';
            const tagHtml = place.tag ? `<span class="category">${place.tag}</span>` : '';
            
            const infoWindow = new naver.maps.InfoWindow({
                content: `
                    <div class="iw-container">
                        <h4>${place.name}</h4>
                        <p>${place.address}</p>
                        <p style="color:#a0a0a0;font-size:12px;">ğŸ“ ê³µì—°ì¥ì—ì„œ ${place.distance}</p>
                        ${descHtml}
                        <div class="iw-footer">
                            ${tagHtml}
                            ${detailBtn}
                        </div>
                    </div>
                `,
                borderWidth: 0,
                backgroundColor: 'transparent'
            });

            // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
            naver.maps.Event.addListener(marker, 'click', function() {
                // ë‹¤ë¥¸ ì •ë³´ì°½ ëª¨ë‘ ë‹«ê¸°
                infoWindows.forEach(iw => iw.close());
                venueInfoWindow.close();
                
                if (infoWindow.getMap()) {
                    infoWindow.close();
                } else {
                    infoWindow.open(map, marker);
                }
            });

            markers.push(marker);
            infoWindows.push(infoWindow);
        });

        // í´ëŸ¬ìŠ¤í„° ì•„ì´ì½˜ ì •ì˜
        const clusterIcon1 = {
            content: '<div class="cluster-marker"></div>',
            size: new naver.maps.Size(40, 40),
            anchor: new naver.maps.Point(20, 20)
        };
        const clusterIcon2 = {
            content: '<div class="cluster-marker" style="width:50px;height:50px;font-size:16px;"></div>',
            size: new naver.maps.Size(50, 50),
            anchor: new naver.maps.Point(25, 25)
        };
        const clusterIcon3 = {
            content: '<div class="cluster-marker" style="width:60px;height:60px;font-size:18px;"></div>',
            size: new naver.maps.Size(60, 60),
            anchor: new naver.maps.Point(30, 30)
        };

        // í´ëŸ¬ìŠ¤í„° ìƒì„± í•¨ìˆ˜
        function createCluster(markersToCluster) {
            if (markerCluster) {
                markerCluster.setMap(null);
            }
            
            markerCluster = new MarkerClustering({
                minClusterSize: 2,
                maxZoom: 17,
                map: map,
                markers: markersToCluster,
                disableClickZoom: false,
                gridSize: 100,
                icons: [clusterIcon1, clusterIcon2, clusterIcon3],
                indexGenerator: [5, 10, 20],
                stylingFunction: function(clusterMarker, count) {
                    const element = clusterMarker.getElement();
                    if (element) {
                        const div = element.querySelector('div');
                        if (div) {
                            div.textContent = count;
                        }
                    }
                }
            });
        }

        // ì´ˆê¸° í´ëŸ¬ìŠ¤í„° ìƒì„±
        createCluster(markers);

        // íƒœê·¸ í•„í„° í•¨ìˆ˜
        function filterByTag(tag) {
            currentTag = tag;
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tag-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === tag);
            });
            
            // ì •ë³´ì°½ ëª¨ë‘ ë‹«ê¸°
            infoWindows.forEach(iw => iw.close());
            venueInfoWindow.close();
            
            // í•„í„°ë§ëœ ë§ˆì»¤
            let filteredMarkers;
            if (tag === 'ì „ì²´') {
                filteredMarkers = markers;
            } else {
                filteredMarkers = markers.filter(m => m.tag === tag);
            }
            
            // í´ëŸ¬ìŠ¤í„° ì¬ìƒì„±
            createCluster(filteredMarkers);
            
            // ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ í•„í„°ë§
            renderFoodList(tag);
        }

        // ë§›ì§‘ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ í•¨ìˆ˜
        function renderFoodList(tag) {
            const foodListContainer = document.getElementById('food-list');
            foodListContainer.innerHTML = '';
            
            const filteredPlaces = tag === 'ì „ì²´' 
                ? foodPlaces 
                : foodPlaces.filter(p => p.tag === tag);
            
            filteredPlaces.forEach((place, idx) => {
                const originalIndex = foodPlaces.indexOf(place);
                const card = document.createElement('div');
                card.className = 'food-card';
                const descHtml = place.description ? `<p class="food-desc">${place.description}</p>` : '';
                const tagHtml = place.tag ? `<span class="category-tag">${place.tag}</span>` : '';
                const detailBtn = place.placeid ? `<a href="https://map.naver.com/p/entry/place/${place.placeid}" target="_blank" class="detail-link" onclick="event.stopPropagation();">ìƒì„¸ì •ë³´ â†’</a>` : '';
                
                card.innerHTML = `
                    <h4>ğŸ½ï¸ ${place.name}</h4>
                    <p>${place.address}</p>
                    ${descHtml}
                    <div class="distance">ğŸ“ ê³µì—°ì¥ì—ì„œ ${place.distance}</div>
                    <div class="card-footer">
                        ${tagHtml}
                        ${detailBtn}
                    </div>
                `;
                
                // ì¹´ë“œ í´ë¦­ ì‹œ í•´ë‹¹ ë§ˆì»¤ë¡œ ì´ë™ ë° ì •ë³´ì°½ ì—´ê¸°
                card.addEventListener('click', () => {
                    const position = new naver.maps.LatLng(place.lat, place.lng);
                    map.setCenter(position);
                    map.setZoom(17);
                    
                    // ë‹¤ë¥¸ ì •ë³´ì°½ ëª¨ë‘ ë‹«ê¸°
                    infoWindows.forEach(iw => iw.close());
                    venueInfoWindow.close();
                    
                    // í•´ë‹¹ ì •ë³´ì°½ ì—´ê¸°
                    infoWindows[originalIndex].open(map, markers[originalIndex]);
                    
                    // ì§€ë„ë¡œ ìŠ¤í¬ë¡¤
                    document.getElementById('food-map').scrollIntoView({ behavior: 'smooth', block: 'center' });
                });
                
                foodListContainer.appendChild(card);
            });
        }

        // ì´ˆê¸° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
        renderFoodList('ì „ì²´');

        // ì§€ë„ í´ë¦­ ì‹œ ëª¨ë“  ì •ë³´ì°½ ë‹«ê¸°
        naver.maps.Event.addListener(map, 'click', function() {
            infoWindows.forEach(iw => iw.close());
            venueInfoWindow.close();
        });
    </script>
</body>
</html>
